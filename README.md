# TechWb-L0: Демонстрационный сервис заказов

Это мой учебный проект для демонстрации работы с очередями сообщений (Kafka) и базой данных (PostgreSQL) на языке Go. Сервис получает данные о заказах, сохраняет их и предоставляет доступ через простой веб-интерфейс.

## Описание проекта

Сервис выполняет следующие функции:

1.  **Подписывается на топик в Kafka**: Слушает сообщения с данными о новых заказах.
2.  **Сохраняет данные в PostgreSQL**: Валидирует и сохраняет полученные данные в базу.
3.  **Кэширует данные**: Для быстрого доступа заказы кэшируются в памяти.
4.  **Восстанавливает кэш**: При старте сервиса кэш заполняется данными из базы данных.
5.  **Предоставляет HTTP API**: Можно получить данные о заказе по его `order_uid`.
6.  **Веб-интерфейс**: Простая HTML-страничка для просмотра заказа по его ID.

## Архитектура

Проект состоит из нескольких частей, которые запускаются вместе с помощью `docker-compose`:

*   **`app`**: Основное приложение на Go.
*   **`db`**: База данных PostgreSQL.
*   **`kafka`**: Брокер сообщений Kafka.
*   **`migrator`**: Сервис, который применяет миграции к базе данных при старте.
*   **`producer`**: Вспомогательный сервис для отправки тестовых сообщений в Kafka.
*   **`web`**: Nginx для отображения веб-интерфейса.

## Как запустить проект

### Требования

*   Docker
*   Docker Compose

### Установка

1.  **Склонируйте репозиторий:**
    ```bash
    git clone https://github.com/RatmirTech/TechWb-L0.git
    cd TechWb-L0
    ```

2.  **Создайте файл `.env`** в корне проекта. Можете скопировать `.env.example` или создать новый и добавить в него переменные окружения, если хотите изменить стандартные настройки. Для запуска со стандартными настройками файл можно оставить пустым.

3.  **Запустите все сервисы:**
    ```bash
    docker compose up --build -d
    ```

## Как пользоваться

### 1. Отправка тестового заказа

Чтобы отправить тестовый заказ в очередь Kafka, выполните команду:

```bash
docker compose run --rm producer
```
Она создаст тестовый заказ и вернёт лог об отправке с ID:
пример
```
2025/08/28 20:05:46 Sent order with ID: 1c8bac5b-2f6d-41test
```

Либо можно заюзать этот аналог:
```bash
dockercompose --profile tools up producer
```

### 2. Просмотр заказа

После того как заказ был отправлен и обработан сервисом, его можно посмотреть.

#### Через веб-интерфейс:

1.  Откройте в браузере `http://localhost:8081/`.
2.  Введите `order_uid` из логов `producer`-а в поле ввода.
3.  Нажмите кнопку "Получить".
4.  Ниже на странице появятся данные заказа в формате JSON.
5. Можно "причесать" json через кнопку Json, либо разобрать на под-блоки кнопкой Разобрать.

#### Через API:

Вы можете получить данные заказа, отправив GET-запрос. Замените `<order_uid>` на ID вашего заказа.

```bash
curl http://localhost:8081/order/<order_uid>
```

## Структура проекта

-   `cmd/`: Основные приложения (сервер, мигратор, продюсер).
-   `internal/`: Внутренняя логика сервиса.
    -   `app/`: Логика запуска приложения.
    -   `cache/`: Кэширование в памяти.
    -   `config/`: Конфигурация.
    -   `httpapi/`: HTTP-сервер.
    -   `kafka/`: Потребитель Kafka.
    -   `models/`: Модели данных.
    -   `repo/`: Работа с базой данных.
-   `migrations/`: SQL-миграции для базы данных.
-   `web/`: Статический HTML-файл для интерфейса.
-   `docker-compose.yml`: Файл для оркестрации сервисов.
